<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">

<title>리서치 입력 프로그램</title>

<style>
.tbl_result {
    width: 100%;
    border: 1px solid;
}
</style>

<script>
//----------------------- 입력 규칙 -----------------------//
const ri_rule = {};
//----------------------- 입력 규칙 -----------------------//

const ri_main = {
    s2ab(s) { 
        // 참고 출처 : https://redstapler.co/sheetjs-tutorial-create-xlsx/
        var buf = new ArrayBuffer(s.length); //convert s to arrayBuffer
        var view = new Uint8Array(buf);  //create uint8array as viewer
        for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF; //convert to octet
        return buf;    
    },

    eventHandler : {
        onClickInput : function() {
            // table head 설정
            // $("#sheet1").append()
        },
        onClickExcel : function() {
            // step 1. workbook 생성
            var workbook = XLSX.utils.book_new();

            // step 2. 시트 만들기 
            var newWorksheet = ri_main.excelHandler.getWorksheet();

            // step 3. workbook에 새로만든 워크시트에 이름을 주고 붙인다.  
            XLSX.utils.book_append_sheet(workbook, newWorksheet, ri_main.excelHandler.getSheetName());

            // step 4. 엑셀 파일 만들기 
            var workbookFile = XLSX.write(workbook, {bookType:'xlsx',  type: 'binary'});

            // step 5. 엑셀 파일 내보내기 
            saveAs(new Blob([ri_main.s2ab(workbookFile)],{type:"application/octet-stream"}), ri_main.excelHandler.getExcelFileName());
        }
    },

    excelHandler : {
        getExcelFileName : function(){
            return 'research_result.xlsx';
        },
        getSheetName : function(){
            return 'sheet1';
        },
        getExcelData : function(){
            return document.getElementById('sheet1'); 
        },
        getWorksheet : function(){
            return XLSX.utils.table_to_sheet(this.getExcelData());
        }
    }    
};
</script>

<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

</head>
<body>
    <fieldset>
        <legend>리서치 입력</legend>
        입력 제한 규칙: <input type="text" id="rule" name="rule" disabled><br>
        <input type="text" id="result" name="result">&nbsp;<a href="javascript:ri_main.eventHandler.onClickInput();">입력</a><br>
        <input type="text" id="illegal" name="illegal" disabled>
    </fieldset>
    <div>
        <!-- 엑셀 출력 -->
        <a href="javascript:ri_main.eventHandler.onClickExcel();">Excel</a>

        <!-- 입력 결과 출력 (삭제 기능) -->
        <table id="sheet1" class="tbl_result">
            <thead>
                <tr>
                    <th scope="col">헤드1</th>
                    <th scope="col">헤드2</th>
                    <th scope="col">헤드3</th>
                    <th scope="col">헤드4</th>
                    <th scope="col">헤드5</th>
                    <th scope="col">헤드6</th>
                    <th scope="col">헤드7</th>
                    <th scope="col">헤드8</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>111</td>
                    <td>222</td>
                    <td>333</td>
                    <td>444</td>
                    <td>555</td>
                    <td>666</td>
                    <td>777</td>
                    <td>888</td>
                </tr>
            </tbody>        
        </table>
    </div>
    
<script>
$(document).ready(function(){
    // 입력규칙 읽어서 설정
    if ($.isEmptyObject(ri_rule)) {
/*        
        alert("입력 규칙 설정 후 사용 가능합니다.");
        $("#result, #put, #excel").attr("disabled", true);
        return;
*/        
    }
});
</script>
</body>
</html>